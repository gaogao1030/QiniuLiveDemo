var YouYuChatBase;YouYuChatBase={appid:"2PKFqnCxPQ8DWMK2uiRWsQpz",secret:"Db8UOjtkzPgG1RrRHJSOPfth",msgTime:void 0,logFlag:!1,log:[],currentClient:{room_name:"qiniuLive",client_id:"游客"},createRealtime:function(e){var t;return _.isUndefined(e)||(this.currentClient.client_id=e),t=AV.realtime({appId:this.appid,clientId:this.currentClient.room_name+":"+this.currentClient.client_id,secure:!1}),this.currentClient.realtime=t,t},getConversation:function(){var e,t,r;return t=new AV.Promise,AV.initialize(this.appid,this.secret),e=AV.Object.extend("_conversation"),r=new AV.Query(e),r.equalTo("attr.room_id",this.currentClient.room_name),r.find({success:function(e){return function(r){var n,i;return n=(null!=(i=r[0])?i.id:void 0)||"null",e.currentClient.conv_id=n,$(document).trigger("conversation_id:Got"),t.resolve(n)}}(this),error:function(e){return function(e){return t.reject(e)}}(this)}),t},connectRoom:function(){var e,t;return e=new AV.Promise,this.createRealtime(),t=this.currentClient.realtime,t.on("open",function(r){return function(){return t.room(r.currentClient.conv_id,function(t){return r.currentClient.room=t,$(document).trigger("room:connected"),e.resolve(t)})}}(this))},createRoom:function(e,t){var r,n;return r=new AV.Promise,this.createRealtime(t),n=this.currentClient.realtime,this.currentClient.room_name=e,this.currentClient.client_id=t,n.on("open",function(e){return function(){return n.room({name:e.currentClient.room_name,attr:{room_id:e.currentClient.room_name},members:[e.currentClient.room_name+":"+e.currentClient.client_id]},function(t){return e.currentClient.room=t,$(document).trigger("room:created"),r.resolve(t)})}}(this))},closeRealTime:function(e){var t;return t=new AV.Promise,e.close(),e.on("close",function(){return t.resolve(),$(document).trigger("realtime:closed")}),t},getLog:function(e){var t;return t=new AV.Promise,this.room=e,this.logFlag?void 0:(this.logFlag=!0,e.log({t:this.msgTime},function(e){return function(r){var n;return e.logFlag=!1,n=r.length,n&&(e.msgTime=r[0].timestamp,r.reverse()),e.log=r,$(document).trigger("log:got"),t.resolve(r)}}(this)),t)},clearRoomMembers:function(e){return e.list(function(t){return e.remove(t,function(){return console.log("clearn room members")})})}};