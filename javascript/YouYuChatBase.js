var YouYuChatBase;YouYuChatBase={baseState:function(){var e;return e={appid:"2PKFqnCxPQ8DWMK2uiRWsQpz",secret:"Db8UOjtkzPgG1RrRHJSOPfth",msgTime:void 0,logFlag:!1,log:[],room_name:"qiniuLive",client_id:"游客"},{set:function(t,r){return e[t]=r},get:function(t){return e[t]}}}(),createRealtime:function(e){var t;return _.isUndefined(e)||this.baseState.set("client_id",e),t=AV.realtime({appId:this.baseState.get("appid"),clientId:this.baseState.get("room_name")+":"+this.baseState.get("client_id"),secure:!1}),this.baseState.set("realtime",t),t},getConversation:function(){var e,t,r;return t=new AV.Promise,AV.initialize(this.baseState.get("appid"),this.baseState.get("secret")),e=AV.Object.extend("_conversation"),r=new AV.Query(e),r.equalTo("attr.room_id",this.baseState.get("room_name")),r.find({success:function(e){return function(r){var n,o;return n=(null!=(o=r[0])?o.id:void 0)||"null",e.baseState.set("members",r[0].attributes.m),e.baseState.set("conv_id",n),$(document).trigger("conversation_id:Got"),t.resolve(n)}}(this),error:function(e){return function(e){return t.reject(e)}}(this)}),t},connectRoom:function(){var e,t;return e=new AV.Promise,this.createRealtime(),t=this.baseState.get("realtime"),t.on("open",function(r){return function(){return t.room(r.baseState.get("conv_id"),function(t){return r.baseState.set("room",t),$(document).trigger("room:connected"),e.resolve(t)})}}(this))},createRoom:function(e,t){var r,n;return r=new AV.Promise,this.createRealtime(t),n=this.baseState.get("realtime"),this.baseState.set("room_name",e),this.baseState.set("client_id",t),n.on("open",function(e){return function(){return n.room({name:e.baseState.get("room_name"),attr:{room_id:e.baseState.get("room_name")},members:[e.baseState.get("room_name")+":"+e.baseState.get("client_id")]},function(t){return e.baseState.set("room",t),$(document).trigger("room:created"),r.resolve(t)})}}(this))},closeRealTime:function(e){var t;return t=new AV.Promise,e.close(),e.on("close",function(){return t.resolve(),$(document).trigger("realtime:closed")}),t},getLog:function(e){var t;return t=new AV.Promise,this.baseState.set("room",e),this.baseState.get("logFlag")?void 0:(this.baseState.set("logFlag",!0),e.log({t:this.baseState.get("msgTime")},function(e){return function(r){var n;return e.baseState.set("logFlag",!1),n=r.length,n&&(e.baseState.set("msgTime",r[0].timestamp),r.reverse()),e.baseState.set("log",r),$(document).trigger("log:got"),t.resolve(r)}}(this)),t)},clearRoomMembers:function(e){return e.list(function(t){return e.remove(t,function(){return console.log("clearn room members")})})}};